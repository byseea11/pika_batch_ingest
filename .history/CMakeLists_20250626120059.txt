cmake_minimum_required(VERSION 3.10)
project(bingest)
set(CMAKE_BUILD_TYPE Debug)

# 设置 C++17 标准
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# 包含头文件目录
include_directories(include test third/ThreadPool)

# 包含 FetchContent 来下载依赖
include(FetchContent)

# 下载 nlohmann/json 库
FetchContent_Declare(
    nlohmann_json
    GIT_REPOSITORY https://github.com/nlohmann/json.git
    GIT_TAG        v3.11.2
)
FetchContent_MakeAvailable(nlohmann_json)

# 添加 GoogleTest
add_subdirectory(third/googletest)

# 设置源文件
file(GLOB_RECURSE SOURCES "src/*.cpp")
file(GLOB_RECURSE TEST_SOURCES "test/*.cpp")

# 设置头文件目录
include_directories(${CMAKE_SOURCE_DIR}/include)

# 添加主程序
add_executable(bingest ${SOURCES})
target_link_libraries(bingest PRIVATE nlohmann_json::nlohmann_json)

# 如果是低版本 GCC，可能需要链接 stdc++fs（C++17 中 filesystem 相关）
if(CMAKE_COMPILER_IS_GNUCXX AND CMAKE_CXX_COMPILER_VERSION VERSION_LESS "9")
    target_link_libraries(bingest PRIVATE stdc++fs)
endif()

# 添加测试程序
add_executable(test_bingest ${TEST_SOURCES})
target_link_libraries(test_bingest PRIVATE gtest gtest_main)

# 启用测试功能
enable_testing()
add_test(NAME test_bingest COMMAND test_bingest)
